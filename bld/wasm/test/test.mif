.CONTINUE
.IGNORE

!ifndef testasm
testasm=wasm
!endif 

!ifdef nulldevice
!else ifdef __UNIX__
nulldevice=/dev/null
!else
nulldevice=nul
!endif

log_file=testasm.log

.BEFORE
    @%create $(log_file)

all : clean $(objs) .SYMBOLIC

!ifdef objs
!ifneq objs
$(objs) : .SYMBOLIC
    @echo ==============================================================
    @echo $(testasm) $^@.asm 
    @echo ==============================================================
    @%append $(nulldevice) $^@
    @%append $(log_file) === $(testasm) $^@ ===
    @$(testasm) -q -zld -wx -nm=$^@.asm $(asm_flags_$^@) $^@.asm -fr=$^@.out -fo=$^@.obj > $(nulldevice)
    @wmake -h -f ../check.mif name=$^@ log_file=$(log_file)
!endif
!endif

clean : .SYMBOLIC
    @rm -f *.obj *.err *.dis *.lst *.tmp *.out mem.trk *.log
